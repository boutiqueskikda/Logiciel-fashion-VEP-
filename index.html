<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ูุงุฌูุฉ ุงูุจุฑูุงูุฌ</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1, h2, h4 {
      color: #333;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .btn {
      background: #007bff;
      color: white;
      padding: 20px;
      border-radius: 15px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    .btn:hover {
      background: #0056b3;
    }
    .section {
      display: none;
      margin-top: 30px;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: right;
    }
    .active {
      display: block !important;
    }
    input, select {
      padding: 8px;
      margin: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      #printArea, #printArea * {
        visibility: visible;
      }
      #printArea {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      .barcode-label {
        page-break-inside: avoid;
        margin: 10px;
      }
    }
  </style>
</head>
<body>
<h1>๐ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงููุชุฌุฑ - BAZAR SERDANI</h1>
<div class="grid">
  <button class="btn" onclick="showSection('add')">โ ุฅุถุงูุฉ ููุชุฌ</button>
  <button class="btn" onclick="showSection('stock')">๐ฆ ุงููุฎุฒูู</button>
  <button class="btn" onclick="showSection('sell')">๐ ุงูุจูุน</button>
  <button class="btn" onclick="showSection('return')">๐ ุงูุฅุฑุฌุงุน</button>
  <button class="btn" onclick="showSection('clients')">๐ฅ ุงูุฒุจุงุฆู ูุงูุฏููู</button>
  <button class="btn" onclick="showSection('stats')">๐ ุงูุฅุญุตุงุฆูุงุช</button>
  <button class="btn" onclick="showSection('print')">๐จ๏ธ ุงูุทุจุงุนุฉ</button>
</div>
<!-- ูุณู ุฅุถุงูุฉ ููุชุฌ -->
<div id="add" class="section">
  <h2>โ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</h2>
  <form id="productForm">
    <label>๐ฆ ุงุณู ุงูููุชุฌ:<br><input type="text" id="productName" required></label><br><br>
    <label>๐ฐ ุณุนุฑ ุงูุดุฑุงุก:<br><input type="number" id="buyPrice" required></label><br><br>
    <label>๐ต ุณุนุฑ ุงูุจูุน:<br><input type="number" id="sellPrice" required></label><br><br>
    <label>๐ฆ ุงููููุฉ:<br><input type="number" id="quantity" required></label><br><br>
    <label>๐ข ุงูุจุงุฑููุฏ (ููููุฏ ุชููุงุฆููุง ุฅุฐุง ุชุฑู ูุงุฑุบูุง):<br><input type="text" id="barcode"></label><br><br>
    <button type="submit">๐ฅ ุญูุธ ุงูููุชุฌ</button>
  </form>
  <p id="addProductMsg" style="color: green; font-weight: bold;"></p>
</div>
<!-- ูุณู ุงููุฎุฒูู -->
<div id="stock" class="section">
  <h2>๐ฆ ุฅุฏุงุฑุฉ ุงููุฎุฒูู</h2>
  <div id="tableContainer"></div>
</div>
<!-- ูุณู ุงูุจูุน -->
<div id="sell" class="section">
  <h2>๐ ุงูุจูุน</h2>
  <input type="text" id="barcodeInput" placeholder="๐ ุฃุฏุฎู ุฃู ุงูุณุญ ุงูุจุงุฑููุฏ" oninput="searchProduct(this.value)" autofocus>
  <div id="saleInfo" style="display:none; background:#f9f9f9; border:1px solid #ccc; padding:10px; margin-top:10px;">
    <p><strong>๐ฆ ุงูููุชุฌ:</strong> <span id="pName"></span></p>
    <p><strong>๐ฐ ุณุนุฑ ุงูุดุฑุงุก:</strong> <span id="pBuy"></span> DA</p>
    <p><strong>๐ต ุณุนุฑ ุงูุจูุน:</strong> <input type="number" id="customSell" style="width:100px;"> DA</p>
    <p><strong>๐ฆ ุงููููุฉ:</strong> <span id="pQty"></span></p>
    <p><strong>๐ ุงูุฑุจุญ:</strong> <span id="profit"></span> DA</p>
    <button onclick="confirmSale()">โ ุชุฃููุฏ ุงูุจูุน</button>
  </div>
  <h4>๐ ุณุฌู ุงููุจูุนุงุช</h4>
  <table>
    <thead>
      <tr>
        <th>ุงูููุชุฌ</th>
        <th>ุดุฑุงุก</th>
        <th>ุจูุน</th>
        <th>ุงูุฑุจุญ</th>
        <th>ุงูููุช</th>
      </tr>
    </thead>
    <tbody id="salesLog"></tbody>
  </table>
</div>
<!-- ูุณู ุงูุฅุฑุฌุงุน -->
<div id="return" class="section">
  <h2>๐ ุฅุฑุฌุงุน ููุชุฌ</h2>
  <input type="text" id="returnSearch" placeholder="๐ ุงุจุญุซ ุจุงูุจุงุฑููุฏ ุฃู ุงุณู ุงูููุชุฌ" oninput="searchReturnProduct()">
  <div id="returnInfo" style="display:none; margin-top:10px; border:1px solid #ccc; padding:10px;">
    <p>๐ฆ ุงูุงุณู: <span id="returnName"></span></p>
    <p>๐ฆ ุงููููุฉ ุงูุญุงููุฉ: <span id="returnQty"></span></p>
    <p>๐ ุนุฏุฏ ุงููุจูุนุงุช: <span id="salesCount">0</span></p>
    <p>โฉ๏ธ ุนุฏุฏ ุงูุฅุฑุฌุงุนุงุช ุงูุณุงุจูุฉ: <span id="returnsCount">0</span></p>
    <p>๐ธ ุณุนุฑ ุงูุจูุน ุนูุฏ ุงูุจูุน: <input type="number" id="returnSell" style="width:100px"> DA</p>
    <button onclick="confirmReturn()">โฉ๏ธ ุชุฃููุฏ ุงูุฅุฑุฌุงุน</button>
  </div>
  <div id="returnResult" style="margin-top:10px; font-weight:bold;"></div>
</div>
<!-- ูุณู ุงูุฒุจุงุฆู ูุงูุฏููู -->
<div id="clients" class="section">
  <h2>๐ฅ ุงูุฒุจุงุฆู ูุงูุฏููู</h2>
  <div>
    <input type="text" id="custName" placeholder="๐ค ุงุณู ุงูุฒุจูู">
    <input type="text" id="custPhone" placeholder="๐ ุฑูู ุงููุงุชู">
    <input type="text" id="custAddress" placeholder="๐ ุงูุนููุงู">
    <input type="number" id="custTotal" placeholder="๐ฐ ุงูุณุนุฑ ุงูุฅุฌูุงูู">
    <input type="number" id="custPaid" placeholder="๐ต ุงููุฏููุน">
    <button onclick="addCustomer()">โ ุฅุถุงูุฉ ุฒุจูู</button>
  </div>
  <div id="customersList" style="margin-top: 20px;"></div>
</div>
<!-- ูุณู ุงูุฅุญุตุงุฆูุงุช -->
<div id="stats" class="section">
  <h2>๐ ุงูุฅุญุตุงุฆูุงุช</h2>
  <div style="margin-top: 10px;">
    <p>๐ฐ ุงูุฑุจุญ ุงููููู ุงูุตุงูู: <span id="dailyProfit">0</span> DA</p>
    <p>๐ ุงูุฑุจุญ ุงูุดูุฑู ุงูุชูุฑูุจู: <span id="monthlyProfit">0</span> DA</p>
    <button onclick="resetDailyProfit()">๐ ุฅุนุงุฏุฉ ุชุนููู ุงูุฑุจุญ ุงููููู</button>
  </div>
</div>
<!-- ูุณู ุงูุทุจุงุนุฉ ุงููุนุฏู ุญุณุจ ุงูุฃุจุนุงุฏ ุงููุทููุจุฉ -->
<div id="print" class="section">
  <h2>๐จ๏ธ ุทุจุงุนุฉ ุงูุจุงุฑููุฏ</h2>
  <label>ุงุฎุชุฑ ุงูููุชุฌ:</label>
  <select id="printProduct">
    <option value="">-- ุงุฎุชุฑ ููุชุฌ --</option>
  </select>
  <label>ุนุฏุฏ ุงููุณุฎ:</label>
  <input type="number" id="printQty" min="1" value="1">
  <button onclick="generateBarcodes()">๐ฆ ุชูููุฏ</button>
  <button onclick="printBarcodes()">๐จ๏ธ ุทุจุงุนุฉ</button>
  <button onclick="document.getElementById('printArea').innerHTML=''">๐๏ธ ูุณุญ</button>
  <div id="printArea" style="margin-top: 20px;"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script>
// ูุชุบูุฑุงุช ุนุงูุฉ
let products = JSON.parse(localStorage.getItem("products") || "[]");
let sales = JSON.parse(localStorage.getItem("sales") || "[]");
let currentProduct = null;
let returnProductIndex = -1;
// ูุธุงุฆู ุนุงูุฉ
function showSection(id) {
  document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  window.scrollTo(0, 0);
  
  // ุชุญุฏูุซ ุงูุจูุงูุงุช ุนูุฏ ูุชุญ ุงููุณู
  if(id === 'stock') renderStock();
  if(id === 'clients') loadCustomers();
  if(id === 'stats') updateStats();
  if(id === 'print') loadProductsForPrint();
  if(id === 'sell') loadSales();
}
function generateEAN13() {
  let base = Math.floor(Math.random() * 100000000000).toString().padStart(12, '0');
  let sum = 0;
  for (let i = 0; i < 12; i++) {
    sum += parseInt(base[i]) * (i % 2 === 0 ? 1 : 3);
  }
  let check = (10 - (sum % 10)) % 10;
  return base + check;
}
// ูุณู ุฅุถุงูุฉ ุงูููุชุฌุงุช
document.getElementById("productForm").addEventListener("submit", function(e) {
  e.preventDefault();
  let name = document.getElementById("productName").value.trim();
  let buy = parseFloat(document.getElementById("buyPrice").value);
  let sell = parseFloat(document.getElementById("sellPrice").value);
  let qty = parseInt(document.getElementById("quantity").value);
  let barcode = document.getElementById("barcode").value.trim() || generateEAN13();
  let product = { name, buy, sell, qty, barcode };
  products.push(product);
  localStorage.setItem("products", JSON.stringify(products));
  document.getElementById("addProductMsg").textContent = "โ ุชู ุญูุธ ุงูููุชุฌ ุจูุฌุงุญ!";
  this.reset();
});
// ูุณู ุงููุฎุฒูู
function renderStock() {
  let html = `
    <table>
      <thead>
        <tr>
          <th>ุงูุงุณู</th>
          <th>ุดุฑุงุก</th>
          <th>ุจูุน</th>
          <th>ุงููููุฉ</th>
          <th>ุงูุจุงุฑููุฏ</th>
          <th>ุชุนุฏูู</th>
          <th>๐๏ธ ุญุฐู</th>
        </tr>
      </thead><tbody>`;
  products.forEach((p, i) => {
    html += `
      <tr>
        <td>${p.name}</td>
        <td>${p.buy} DA</td>
        <td>${p.sell} DA</td>
        <td>${p.qty}</td>
        <td>${p.barcode}</td>
        <td><button onclick="editProduct(${i})">โ๏ธ</button></td>
        <td><button onclick="deleteProduct(${i})">๐๏ธ</button></td>
      </tr>`;
  });
  html += "</tbody></table>";
  document.getElementById("tableContainer").innerHTML = html;
}
function deleteProduct(i) {
  if (confirm("โ ูู ุชุฑูุฏ ุญุฐู ูุฐุง ุงูููุชุฌุ")) {
    products.splice(i, 1);
    localStorage.setItem("products", JSON.stringify(products));
    renderStock();
  }
}
function editProduct(i) {
  const p = products[i];
  const name = prompt("๐ฆ ุงุณู ุงูููุชุฌ:", p.name);
  const buy = prompt("๐ฐ ุณุนุฑ ุงูุดุฑุงุก:", p.buy);
  const sell = prompt("๐ต ุณุนุฑ ุงูุจูุน:", p.sell);
  const qty = prompt("๐ฆ ุงููููุฉ:", p.qty);
  if (name && buy && sell && qty) {
    products[i] = {
      ...p,
      name,
      buy: parseFloat(buy),
      sell: parseFloat(sell),
      qty: parseInt(qty)
    };
    localStorage.setItem("products", JSON.stringify(products));
    renderStock();
  }
}
// ูุณู ุงูุจูุน
function searchProduct(code) {
  const p = products.find(prod => prod.barcode === code || prod.name.includes(code));
  if (p) {
    currentProduct = p;
    document.getElementById("saleInfo").style.display = "block";
    document.getElementById("pName").textContent = p.name;
    document.getElementById("pBuy").textContent = p.buy;
    document.getElementById("customSell").value = p.sell;
    document.getElementById("pQty").textContent = p.qty;
    calculateProfit();
  } else {
    document.getElementById("saleInfo").style.display = "none";
    currentProduct = null;
  }
}
document.getElementById("customSell").oninput = calculateProfit;
function calculateProfit() {
  if (!currentProduct) return;
  const sell = parseFloat(document.getElementById("customSell").value);
  const profit = sell - currentProduct.buy;
  document.getElementById("profit").textContent = profit.toFixed(2);
}
function confirmSale() {
  if (!currentProduct) return;
  const sell = parseFloat(document.getElementById("customSell").value);
  const profit = sell - currentProduct.buy;
  const time = new Date().toLocaleString();
  const i = products.findIndex(p => p.barcode === currentProduct.barcode);
  if (products[i].qty <= 0) return alert("โ ูุง ุชูุฌุฏ ูููุฉ ูุงููุฉ!");
  products[i].qty -= 1;
  localStorage.setItem("products", JSON.stringify(products));
  sales.push({ name: currentProduct.name, buy: currentProduct.buy, sell, profit, time });
  localStorage.setItem("sales", JSON.stringify(sales));
  let dp = parseFloat(localStorage.getItem("dailyProfit") || "0");
  dp += profit;
  localStorage.setItem("dailyProfit", dp);
  alert("โ ุชู ุงูุจูุน!");
  currentProduct = null;
  document.getElementById("barcodeInput").value = "";
  document.getElementById("saleInfo").style.display = "none";
  loadSales();
}
function loadSales() {
  const tbody = document.getElementById("salesLog");
  tbody.innerHTML = "";
  sales.slice().reverse().forEach(s => {
    tbody.innerHTML += `
      <tr>
        <td>${s.name}</td>
        <td>${s.buy}</td>
        <td>${s.sell}</td>
        <td>${s.profit}</td>
        <td>${s.time}</td>
      </tr>`;
  });
}
// ูุณู ุงูุฅุฑุฌุงุน
function searchReturnProduct() {
  const val = document.getElementById("returnSearch").value.trim();
  const foundIndex = products.findIndex(p => p.barcode === val || p.name.includes(val));
  if (foundIndex !== -1) {
    const product = products[foundIndex];
    returnProductIndex = foundIndex;
    document.getElementById("returnName").innerText = product.name;
    document.getElementById("returnQty").innerText = product.qty;
    document.getElementById("returnSell").value = product.sell;
    
    // ุญุณุงุจ ุนุฏุฏ ุงููุจูุนุงุช ูุงูุฅุฑุฌุงุนุงุช
    const salesCount = sales.filter(s => s.name === product.name).length;
    const returns = JSON.parse(localStorage.getItem("returns") || "{}");
    const returnsCount = returns[product.barcode] || 0;
    
    document.getElementById("salesCount").innerText = salesCount;
    document.getElementById("returnsCount").innerText = returnsCount;
    
    document.getElementById("returnInfo").style.display = "block";
  } else {
    document.getElementById("returnInfo").style.display = "none";
  }
}
function confirmReturn() {
  if (returnProductIndex === -1) return;
  const prod = products[returnProductIndex];
  const barcode = prod.barcode;
  const sellBack = parseFloat(document.getElementById("returnSell").value);
  // ุญุณุงุจ ุนุฏุฏ ุงููุจูุนุงุช ูุงูุฅุฑุฌุงุนุงุช
  const salesCount = sales.filter(s => s.name === prod.name).length;
  const returns = JSON.parse(localStorage.getItem("returns") || "{}");
  const returnsCount = returns[barcode] || 0;
  if (returnsCount >= salesCount) {
    alert("โ ูุง ูููู ุฅุฑุฌุงุน ุฃูุซุฑ ูู ุนุฏุฏ ุงููุจูุนุงุช!");
    return;
  }
  // ุชุญุฏูุซ ุงููููุฉ
  prod.qty += 1;
  localStorage.setItem("products", JSON.stringify(products));
  // ุชุญุฏูุซ ุงูุฑุจุญ ุงููููู
  let dailyProfit = parseFloat(localStorage.getItem("dailyProfit") || "0");
  dailyProfit -= sellBack;
  localStorage.setItem("dailyProfit", dailyProfit);
  // ุชุญุฏูุซ ุณุฌู ุงูุฅุฑุฌุงุนุงุช
  returns[barcode] = returnsCount + 1;
  localStorage.setItem("returns", JSON.stringify(returns));
  // ุฅุถุงูุฉ ููุณุฌู
  let logs = JSON.parse(localStorage.getItem("salesLog") || "[]");
  logs.unshift(`${new Date().toLocaleString()} - โฉ๏ธ ุฅุฑุฌุงุน ${prod.name} - ุฎุตู ${sellBack.toFixed(2)} DA`);
  localStorage.setItem("salesLog", JSON.stringify(logs));
  document.getElementById("returnResult").innerText = `โฉ๏ธ ุชู ุฅุฑุฌุงุน ${prod.name} | -${sellBack.toFixed(2)} DA ูู ุงูุฑุจุญ | ุงูุฅุฑุฌุงุนุงุช: ${returns[barcode]}/${salesCount}`;
  searchReturnProduct();
}
// ูุณู ุงูุฒุจุงุฆู ูุงูุฏููู
function loadCustomers() {
  const customers = JSON.parse(localStorage.getItem("customers") || "[]");
  let html = "";
  customers.forEach((cust, i) => {
    const remaining = cust.total - cust.paid;
    html += `
      <div style="border:1px solid #ccc; margin:10px; padding:10px;">
        <strong>๐ค ${cust.name}</strong><br>
        ๐ ${cust.phone}<br>
        ๐ ${cust.address}<br>
        ๐ฐ ุงูุณุนุฑ ุงูุฅุฌูุงูู: ${cust.total} DA<br>
        ๐ต ุงููุฏููุน: ${cust.paid} DA<br>
        ๐งพ ุงูุจุงูู: ${remaining} DA<br>
        <button onclick="editCustomer(${i})">โ๏ธ ุชุนุฏูู</button>
        <button onclick="deleteCustomer(${i})">๐๏ธ ุญุฐู</button>
        ${remaining > 0 ? `<button onclick="recoverDebt(${i})">๐ต ุงุณุชุฑุฌุงุน ุงูุฏูู</button>` : "โ ููุชูู"}
      </div>
    `;
  });
  document.getElementById("customersList").innerHTML = html;
}
function addCustomer() {
  const name = document.getElementById("custName").value.trim();
  const phone = document.getElementById("custPhone").value.trim();
  const address = document.getElementById("custAddress").value.trim();
  const total = parseFloat(document.getElementById("custTotal").value);
  const paid = parseFloat(document.getElementById("custPaid").value);
  if (!name || isNaN(total) || isNaN(paid)) return alert("ูุฑุฌู ููุก ูู ุงูุญููู ุจุดูู ุตุญูุญ");
  const customers = JSON.parse(localStorage.getItem("customers") || "[]");
  customers.push({ name, phone, address, total, paid });
  localStorage.setItem("customers", JSON.stringify(customers));
  loadCustomers();
}
function deleteCustomer(index) {
  const customers = JSON.parse(localStorage.getItem("customers") || "[]");
  if (confirm("โ ูู ุชุฑูุฏ ุญุฐู ูุฐุง ุงูุฒุจููุ")) {
    customers.splice(index, 1);
    localStorage.setItem("customers", JSON.stringify(customers));
    loadCustomers();
  }
}
function editCustomer(index) {
  const customers = JSON.parse(localStorage.getItem("customers") || "[]");
  const c = customers[index];
  const name = prompt("โ๏ธ ุงุณู ุงูุฒุจูู:", c.name);
  const phone = prompt("๐ ุฑูู ุงููุงุชู:", c.phone);
  const address = prompt("๐ ุงูุนููุงู:", c.address);
  const total = parseFloat(prompt("๐ฐ ุงูุณุนุฑ ุงูุฅุฌูุงูู:", c.total));
  const paid = parseFloat(prompt("๐ต ุงููุฏููุน:", c.paid));
  if (!name || isNaN(total) || isNaN(paid)) return alert("ุงูุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ");
  customers[index] = { name, phone, address, total, paid };
  localStorage.setItem("customers", JSON.stringify(customers));
  loadCustomers();
}
function recoverDebt(index) {
  const customers = JSON.parse(localStorage.getItem("customers") || "[]");
  const c = customers[index];
  const remaining = c.total - c.paid;
  const amount = parseFloat(prompt("๐ต ูู ุงููุจูุบ ุงูุฐู ุชู ุฏูุนู ุงูุขูุ", remaining));
  if (isNaN(amount) || amount <= 0) return alert("ุงููุจูุบ ุบูุฑ ุตุญูุญ");
  customers[index].paid += amount;
  if (customers[index].paid > customers[index].total) {
    customers[index].paid = customers[index].total;
  }
  localStorage.setItem("customers", JSON.stringify(customers));
  let dailyProfit = parseFloat(localStorage.getItem("dailyProfit") || "0");
  dailyProfit += amount;
  localStorage.setItem("dailyProfit", dailyProfit);
  loadCustomers();
}
// ูุณู ุงูุฅุญุตุงุฆูุงุช
function updateStats() {
  const daily = parseFloat(localStorage.getItem("dailyProfit") || "0");
  const monthly = daily * new Date().getDate(); // ุงูุชูุฏูุฑ ุงูุดูุฑู ุญุณุจ ุงูุฃูุงู ุงูุญุงููุฉ
  document.getElementById("dailyProfit").innerText = daily.toFixed(2);
  document.getElementById("monthlyProfit").innerText = monthly.toFixed(2);
}
function resetDailyProfit() {
  if (confirm("โ ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุชุตููุฑ ุงูุฑุจุญ ุงูููููุ")) {
    localStorage.setItem("dailyProfit", "0");
    updateStats();
  }
}
// ูุณู ุงูุทุจุงุนุฉ ุงููุนุฏู ุญุณุจ ุงูุฃุจุนุงุฏ ุงููุทููุจุฉ
function loadProductsForPrint() {
  const select = document.getElementById("printProduct");
  select.innerHTML = '<option value="">-- ุงุฎุชุฑ ููุชุฌ --</option>';
  
  products.forEach(p => {
    let option = document.createElement("option");
    option.value = p.barcode;
    option.textContent = p.name;
    select.appendChild(option);
  });
}
function generateBarcodes() {
  const barcode = document.getElementById("printProduct").value;
  const qty = parseInt(document.getElementById("printQty").value);
  const container = document.getElementById("printArea");
  if (!barcode || qty < 1) {
    alert("โ ุงุฎุชุฑ ููุชุฌ ูุนุฏุฏ ุตุญูุญ");
    return;
  }
  const product = products.find(p => p.barcode === barcode);
  if (!product) {
    alert("โ ุงูููุชุฌ ุบูุฑ ููุฌูุฏ");
    return;
  }
  container.innerHTML = "";
  for (let i = 0; i < qty; i++) {
    const box = document.createElement("div");
    box.className = "barcode-label";
    box.style.border = "1px solid #000";
    box.style.textAlign = "center";
    box.style.padding = "2px";
    box.style.margin = "5px";
    box.style.display = "inline-block";
    box.style.width = "35mm";
    box.style.height = "20mm";
    box.style.overflow = "hidden";
    box.style.fontFamily = "Arial, sans-serif";
    box.style.boxSizing = "border-box";
    box.innerHTML = `
      <div style="font-weight:bold; font-size:10px; color:#2c3e50; margin-bottom:2px;">BAZAR SERDANI</div>
      <div style="margin:2px 0; font-size:9px; font-weight:bold;">Prix: ${formatPrice(product.sell)} DA</div>
      <div style="margin:1px 0 2px 0;">
        <svg class="barcode" data-code="${product.barcode}" style="display:block; margin:0 auto;"></svg>
      </div>
      <div style="font-size:7px; margin-top:2px; word-break: break-all;">${product.barcode}</div>
    `;
    container.appendChild(box);
  }
  document.querySelectorAll(".barcode").forEach(svg => {
    JsBarcode(svg, svg.dataset.code, {
      format: "CODE128",
      displayValue: false,
      width: 1.2,
      height: 20,
      margin: 2
    });
  });
}
function printBarcodes() {
  if (document.getElementById("printArea").children.length === 0) {
    alert("โ ุงูุฑุฌุงุก ุชูููุฏ ุงูุจุงุฑููุฏ ุฃููุงู");
    return;
  }
  window.print();
}
function formatPrice(p) {
  let s = Math.round(p).toString();
  return s.length > 3 ? s.slice(0, -3) + " " + s.slice(-3) : s;
}
// ุชููุฆุฉ ุฃูููุฉ
document.addEventListener("DOMContentLoaded", function() {
  loadSales();
  updateStats();
  loadProductsForPrint();
  
  // ุฅุถุงูุฉ ุญุฏุซ Enter ูุญูู ุงูุจุญุซ ูู ุงูุฅุฑุฌุงุน
  document.getElementById("returnSearch").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      searchReturnProduct();
    }
  });
});
</script>
</body>
</html>